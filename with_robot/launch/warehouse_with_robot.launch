<?xml version="1.0"?>
<launch>
  <!-- Warehouse PedSim + Gazebo Simulation WITH ROBOT (Pioneer3DX) -->
  <param name="use_sim_time" value="true"/>

  <!-- Arguments -->
  <arg name="scene_file" default="/environment/scenarios/warehouse_pedsim.xml"/>
  <arg name="world_file" default="/environment/worlds/warehouse.world"/>
  <arg name="simulation_factor" default="1.0"/>
  <arg name="update_rate" default="25.0"/>
  <arg name="gui" default="true"/>

  <!-- Robot initial pose (from warehouse.json: robot_start: [-9, 9]) -->
  <arg name="robot_name" default="p3dx"/>
  <arg name="pose_initial_x" default="-9.0"/>
  <arg name="pose_initial_y" default="9.0"/>
  <arg name="pose_initial_z" default="0.01"/>

  <!-- Start Gazebo with warehouse world -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="world_name" value="$(arg world_file)"/>
    <arg name="paused" value="false"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="gui" value="$(arg gui)"/>
    <arg name="headless" value="false"/>
    <arg name="debug" value="false"/>
  </include>

  <!-- Spawn PedSim agents to Gazebo -->
  <node pkg="pedsim_gazebo_plugin" type="spawn_pedsim_agents.py" name="spawn_pedsim_agents" output="screen"/>

  <!-- TF: Place gazebo frame at map frame -->
  <node pkg="tf" type="static_transform_publisher" name="gazebo_map_broadcaster"
      args="0 0 0 0 0 0 odom gazebo 100"/>

  <!-- PedSim Simulator Node WITH ROBOT -->
  <node name="pedsim_simulator" pkg="pedsim_simulator" type="pedsim_simulator" output="screen">
    <param name="scene_file" value="$(arg scene_file)" type="string"/>
    <param name="simulation_factor" value="$(arg simulation_factor)" type="double"/>
    <param name="update_rate" value="$(arg update_rate)" type="double"/>
    <param name="default_queue_size" value="10" type="int"/>
    <param name="max_robot_speed" value="1.5" type="double"/>
    <param name="robot_mode" value="1" type="int"/>
    <param name="enable_groups" value="true" type="bool"/>
    <param name="frame_id" value="gazebo"/>
  </node>

  <!-- PedSim Visualizer -->
  <include file="$(find pedsim_visualizer)/launch/visualizer.launch"/>

  <!-- Pioneer3DX Robot -->
  <param name="robot_description" command="$(find xacro)/xacro '$(find multi_robot_scenario)/xacro/p3dx/pioneer3dx.xacro'"/>

  <node name="urdf_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
        args="-urdf -model $(arg robot_name) -param robot_description -x $(arg pose_initial_x) -y $(arg pose_initial_y) -z $(arg pose_initial_z)"/>

  <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher">
    <param name="publish_frequency" type="double" value="30.0"/>
  </node>

  <node pkg="joint_state_publisher" type="joint_state_publisher" name="joint_state_publisher">
    <param name="publish_frequency" type="double" value="30.0"/>
  </node>

</launch>
